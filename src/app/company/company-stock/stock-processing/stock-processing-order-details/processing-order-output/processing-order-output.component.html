<ng-container>
    <h2 *ngIf="actionType !== 'SHIPMENT'"
        i18n="@@productLabelStockProcessingOrderDetail.section.output.outputsSectionTitle">Outputs of this processing</h2>
    
    <!-- CLASSIFICATION MODE: Use specialized component -->
    <!--  El backend crea autom谩ticamente el segundo StockOrder para producto rechazado -->
    <ng-container *ngIf="isClassificationMode()">
        <app-processing-order-output-classification
            *ngFor="let tsoGroup of targetStockOrdersArray.controls; index as tsoGroupIndex"
            [tsoGroup]="$any(tsoGroup)"
            [tsoGroupIndex]="tsoGroupIndex"
            [outputQuantityLabel]="targetStockOrderOutputQuantityLabel"
            [submitted]="submitted"
            [rightSideEnabled]="rightSideEnabled"
            [procActionLotPrefixControl]="procActionLotPrefixControl"
            [outputSemiProductsCodebook]="outputSemiProductsCodebook"
            [semiProductOutputFacilitiesCodebooks]="semiProductOutputFacilitiesCodebooks"
            (removeOutputEvent)="removeOutput($event)">
        </app-processing-order-output-classification>
    </ng-container>

    <!-- STANDARD MODE: Use regular output form -->
    <ng-container *ngIf="!isClassificationMode()">
        <div class="af-form-element position-relative outputs-bottom-spacing processing-section"
             [class.output]="actionType !== 'SHIPMENT'"
             *ngFor="let tsoGroup of targetStockOrdersArray.controls; index as tsoGroupIndex">

        <!-- CONTROLS FOR DISPLAYING AND SELECTING OUTPUT STOCK UNIT -->
        <div class="af-row">

            <!-- HANDLE CASE WHEN WE HAVE OUTPUT FINAL PRODUCT INSTEAD OF OUTPUT SEMI-PRODUCTS -->
            <ng-container *ngIf="currentOutputFinalProduct; else outputSemiProduct">
                <div class="af-c12">
                    <textinput
                            [form]="outputFinalProductNameControl"
                            label="Final product type"
                            i18n-label="@@productLabelStockProcessingOrderDetail.textinput.finalProductType.label"
                            style="width: 100%">
                    </textinput>
                </div>
            </ng-container>
            <ng-template #outputSemiProduct>
                <div class="af-c12 d-flex">
                    <div class="flex-fill">
                        <single-choice
                                label="Semi-product type"
                                i18n-label="@@productLabelStockProcessingOrderDetail.outputsSemiProductForm.label"
                                [formControlInput]="$any(tsoGroup.get('semiProduct'))"
                                [codebookService]="outputSemiProductsCodebook"
                                [clearable]="false"
                                style="min-width: 150px;"
                                [isInvalidChoice]="submitted && tsoGroup.get('semiProduct').invalid">
                            <ng-container *ngIf="submitted">
                                <div *ngIf="tsoGroup.get('semiProduct').errors as errors" class="sc-invalid-feedback"
                                     i18n="@@productLabelStockProcessingOrderDetail.outputsSemiProductForm.error">
                                    Output Semi-product is required
                                </div>
                            </ng-container>
                        </single-choice>
                    </div>
                    <div class="ml-4">
                        <div class="delete-output-icon"
                             [class.disabled]="targetStockOrdersArray.length < 2"
                             (click)="removeOutput(tsoGroupIndex)">
                            <fa-icon class="del-icon" [icon]="faTrashAlt"></fa-icon>
                        </div>
                    </div>
                </div>
            </ng-template>

        </div>

        <!-- CONTROLS FOR SELECTING OUTPUT FACILITY -->
        <div class="af-row">
            <div class="af-c12">
                <single-choice
                        *ngIf="currentOutputFinalProduct || tsoGroup.get('semiProduct').value"
                        label="Facility"
                        i18n-label="@@productLabelStockProcessingOrderDetail.outputFacilityForm.label"
                        [formControlInput]="$any(tsoGroup.get('facility'))"
                        [codebookService]="getOutputFacilityCodebook($any(tsoGroup))"
                        [clearable]="false"
                        style="min-width: 150px;"
                        [isInvalidChoice]="submitted && tsoGroup.get('facility').invalid">
                    <ng-container *ngIf="submitted">
                        <div *ngIf="tsoGroup.get('facility').errors as errors" class="sc-invalid-feedback"
                             i18n="@@productLabelStockProcessingOrderDetail.outputFacilityForm.error">
                            Output facility is required
                        </div>
                    </ng-container>
                </single-choice>
            </div>
        </div>

        <!-- THE USER ENTERED ORDER ID - RELEVANT FOR QUOTE ORDER AND CAN BE SET ONLY WHEN NO PRODUCT ORDER IS PRESENT -->
        <div class="af-row" *ngIf="actionType === 'SHIPMENT' && !productOrderId">
            <div class="af-c12">
                <textinput
                        [form]="$any(tsoGroup.get('orderId'))"
                        label="Order ID"
                        placeholder="Enter the order ID"
                        style="width: 100%"
                        i18n-label="@@productLabelStockProcessingOrderDetail.textinput.orderId.label"
                        i18n-placeholder="productLabelStockProcessingOrderDetail.textinput.orderId.placeholder">
                </textinput>
            </div>
        </div>

        <!-- THE INTERNAL LOT NUMBER -->
        <!-- Hidden when input facility is laboratory (lot assigned AFTER lab tests) -->
        <div class="af-row" *ngIf="!shouldHideLotFields()">
            <div class="af-c3">
                <textinput
                        [form]="procActionLotPrefixControl"
                        label="Prefix"
                        style="width: 100%"
                        i18n-label="@@productLabelStockProcessingOrderDetail.textinput.lotPrefix.label">
                </textinput>
            </div>
            <div class="af-c9">
                <textinput
                        [form]="$any(tsoGroup.get('internalLotNumber'))"
                        label="Internal lot name"
                        style="width: 100%" 
                        placeholder="Enter internal lot name"
                        i18n-label="@@productLabelStockProcessingOrderDetail.textinput.internalLotNumber.label"
                        i18n-placeholder="@@productLabelStockProcessingOrderDetail.textinput.internalLotNumber.placeholder"
                        [isInvalid]="submitted && tsoGroup.get('internalLotNumber').invalid">
                    <ng-container *ngIf="submitted">
                        <div *ngIf="tsoGroup.get('internalLotNumber').errors as errors" class="sc-invalid-feedback">
                            <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.internalLotNumber.textinput.error">
                                Internal lot name is required
                            </div>
                        </div>
                    </ng-container>
                </textinput>
            </div>
        </div>

        <!-- WEEK NUMBER (1-53) -->

        <!-- FORM CONTROLS FOR DEFINING OUTPUT QUANTITY -->
        <div *ngIf="shouldShowOutputQuantity()" class="af-row">
            <div class="af-c6">
                <textinput
                        [form]="$any(tsoGroup.get('totalQuantity'))"
                        label="{{ targetStockOrderOutputQuantityLabel + ' ' + (tsoGroup.get('measureUnitType')?.value ? tsoGroup.get('measureUnitType').value.label : '-') }}"
                        style="width: 100%"
                        placeholder="Enter quantity"
                        i18n-placeholder="@@productLabelStockProcessingOrderDetail.textinput.outputQuantity.placeholder">
                    <ng-container *ngIf="submitted">
                        <div *ngIf="tsoGroup.get('totalQuantity').errors as errors" class="sc-invalid-feedback">
                            <div *ngIf="errors.required">
                        <span *ngIf="actionType != 'SHIPMENT'; else quoteQuantityRequired"
                              i18n="@@productLabelStockProcessingOrderDetail.outputQuantity.textinput.error.required">Quantity is required</span>
                                <ng-template #quoteQuantityRequired>
                                    <span i18n="@@productLabelStockProcessingOrderDetail.outputQuantity.textinput.error.requiredOnQuote">Enter the desired output quantity</span>
                                </ng-template>
                            </div>
                        </div>
                        <div *ngIf="notAllOutputQuantityIsUsed(tsoGroup)" class="sc-invalid-feedback">
                            <span i18n="@@productLabelStockProcessingOrderDetail.outputQuantity.textinput.error.notAllOutputQuantityIsUsed">Entered output quantity is not used completely</span>
                        </div>
                    </ng-container>
                </textinput>
            </div>
        </div>

        <!-- IF PROCESSING ACTION IS OF TYPE 'SHIPMENT' SHOW CONTROL FOR DELIVERY TIME -->
        <div class="af-row" *ngIf="actionType === 'SHIPMENT'">
            <div class="af-c6">
                <app-datepicker
                        label="Preferred delivery date"
                        i18n-label="@@productLabelStockProcessingOrderDetail.textinput.preferedDeliveryDate.label"
                        [form]="tsoGroup.get('deliveryTime')"
                        [invalid]="submitted && tsoGroup.get('deliveryTime').invalid">
                    <ng-container>
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('deliveryTime').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.preferedDeliveryDate.textinput.error">
                                    Preferred delivery date is required
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </app-datepicker>
            </div>
        </div>
        
        <!-- CAMPOS ESPECFICOS PARA CONGELACIN (solo cuando el facility de entrada es de congelaci贸n) -->
        <ng-container *ngIf="shouldShowFreezingSection(tsoGroup)">
            <div class="af-row mt-3">
                <div class="af-c12">
                    <h4 i18n="@@productLabelStockProcessingOrderDetail.section.freezing.title">CONGELACIN</h4>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('freezingType'))"
                            label="Tipo de Congelaci贸n"
                            placeholder="Ej., IQF, Bloque"
                            i18n-label="@@productLabelStockProcessingOrderDetail.freezing.type.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.freezing.type.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('freezingType').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('freezingType').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.freezing.type.error">
                                    El tipo de congelaci贸n es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Ingreso"
                            i18n-label="@@productLabelStockProcessingOrderDetail.freezing.entryDate.label"
                            [form]="tsoGroup.get('freezingEntryDate')"
                            [invalid]="submitted && tsoGroup.get('freezingEntryDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('freezingEntryDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.freezing.entryDate.error">
                                    La fecha de ingreso es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Salida"
                            i18n-label="@@productLabelStockProcessingOrderDetail.freezing.exitDate.label"
                            [form]="tsoGroup.get('freezingExitDate')"
                            [invalid]="submitted && tsoGroup.get('freezingExitDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('freezingExitDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.freezing.exitDate.error">
                                    La fecha de salida es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c12">
                    <textinput
                            [form]="$any(tsoGroup.get('freezingTemperatureControl'))"
                            label="Control de Temperatura"
                            placeholder="Ej., -18掳C, rango de temperaturas"
                            i18n-label="@@productLabelStockProcessingOrderDetail.freezing.temperatureControl.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.freezing.temperatureControl.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('freezingTemperatureControl').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('freezingTemperatureControl').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.freezing.temperatureControl.error">
                                    El control de temperatura es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>
            </div>
        </ng-container>

        <!-- CAMPOS ESPECFICOS PARA TNEL DE CONGELACIN (solo cuando el facility de entrada es t煤nel) -->
        <ng-container *ngIf="shouldShowTunnelSection()">
            <div class="af-row mt-3">
                <div class="af-c12">
                    <h4 i18n="@@productLabelStockProcessingOrderDetail.section.tunnel.title">TNEL DE CONGELACIN</h4>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de producci贸n"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.productionDate.label"
                            [form]="tsoGroup.get('tunnelProductionDate')"
                            [invalid]="submitted && tsoGroup.get('tunnelProductionDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelProductionDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.productionDate.error">
                                    La fecha de producci贸n es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Expiraci贸n"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.expirationDate.label"
                            [form]="tsoGroup.get('tunnelExpirationDate')"
                            [invalid]="submitted && tsoGroup.get('tunnelExpirationDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelExpirationDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.expirationDate.error">
                                    La fecha de expiraci贸n es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c3">
                    <textinput
                            [form]="$any(tsoGroup.get('tunnelNetWeight'))"
                            label="Peso Neto"
                            placeholder="Ej., peso neto total"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.netWeight.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.tunnel.netWeight.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('tunnelNetWeight').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelNetWeight').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.netWeight.error">
                                    El peso neto es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c3">
                    <textinput
                            [form]="$any(tsoGroup.get('tunnelSupplier'))"
                            label="Proveedor"
                            placeholder="Ej., nombre del proveedor"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.supplier.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.tunnel.supplier.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('tunnelSupplier').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelSupplier').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.supplier.error">
                                    El proveedor es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c4">
                    <textinput
                            [form]="$any(tsoGroup.get('tunnelFreezingType'))"
                            label="Tipo Congelaci贸n"
                            placeholder="Ej., IQF, t煤nel continuo"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.freezingType.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.tunnel.freezingType.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('tunnelFreezingType').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelFreezingType').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.freezingType.error">
                                    El tipo de congelaci贸n es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c4">
                    <app-datepicker
                            label="Fecha de Ingreso"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.entryDate.label"
                            [form]="tsoGroup.get('tunnelEntryDate')"
                            [invalid]="submitted && tsoGroup.get('tunnelEntryDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelEntryDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.entryDate.error">
                                    La fecha de ingreso es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c4">
                    <app-datepicker
                            label="Fecha de Salida"
                            i18n-label="@@productLabelStockProcessingOrderDetail.tunnel.exitDate.label"
                            [form]="tsoGroup.get('tunnelExitDate')"
                            [invalid]="submitted && tsoGroup.get('tunnelExitDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('tunnelExitDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.tunnel.exitDate.error">
                                    La fecha de salida es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>
            </div>
        </ng-container>

        <!-- CAMPOS ESPECFICOS PARA REA DE LAVADO (solo cuando el facility de entrada es de lavado) -->
        <ng-container *ngIf="shouldShowWashingSection()">
            <div class="af-row mt-3">
                <div class="af-c12">
                    <h4 i18n="@@productLabelStockProcessingOrderDetail.section.washing.title">REA DE LAVADO</h4>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('washingWaterTemperature'))"
                            label="Temperatura del Agua"
                            placeholder="Ej., temperatura del agua de lavado"
                            i18n-label="@@productLabelStockProcessingOrderDetail.washing.waterTemperature.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.washing.waterTemperature.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('washingWaterTemperature').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('washingWaterTemperature').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.washing.waterTemperature.error">
                                    La temperatura del agua es requerida
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('washingShrimpTemperatureControl'))"
                            label="P.C. de la temperatura del camar贸n"
                            placeholder="Ej., punto cr铆tico/control de temperatura del camar贸n"
                            i18n-label="@@productLabelStockProcessingOrderDetail.washing.shrimpTemperatureControl.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.washing.shrimpTemperatureControl.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('washingShrimpTemperatureControl').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('washingShrimpTemperatureControl').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.washing.shrimpTemperatureControl.error">
                                    El P.C. de la temperatura del camar贸n es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>
            </div>
        </ng-container>

        <!-- CAMPOS ESPECFICOS PARA TRATAMIENTO (solo cuando el facility de entrada es de tratamiento) -->
        <ng-container *ngIf="shouldShowTreatmentSection()">
            <div class="af-row mt-3">
                <div class="af-c12">
                    <h4 i18n="@@productLabelStockProcessingOrderDetail.section.treatment.title">TRATAMIENTO</h4>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('treatmentType'))"
                            label="Tipo de Corte"
                            placeholder="Ej., inmersi贸n, rociado"
                            i18n-label="@@productLabelStockProcessingOrderDetail.treatment.type.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.treatment.type.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('treatmentType').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('treatmentType').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.treatment.type.error">
                                    El tipo de corte es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Ingreso"
                            i18n-label="@@productLabelStockProcessingOrderDetail.treatment.entryDate.label"
                            [form]="tsoGroup.get('treatmentEntryDate')"
                            [invalid]="submitted && tsoGroup.get('treatmentEntryDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('treatmentEntryDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.treatment.entryDate.error">
                                    La fecha de ingreso es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Salida"
                            i18n-label="@@productLabelStockProcessingOrderDetail.treatment.exitDate.label"
                            [form]="tsoGroup.get('treatmentExitDate')"
                            [invalid]="submitted && tsoGroup.get('treatmentExitDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('treatmentExitDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.treatment.exitDate.error">
                                    La fecha de salida es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('treatmentTemperatureControl'))"
                            label="Control de Temperatura"
                            placeholder="Ej., rango de temperaturas durante el tratamiento"
                            i18n-label="@@productLabelStockProcessingOrderDetail.treatment.temperatureControl.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.treatment.temperatureControl.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('treatmentTemperatureControl').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('treatmentTemperatureControl').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.treatment.temperatureControl.error">
                                    El control de temperatura es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('treatmentChemicalUsed'))"
                            label="Qu铆mico utilizado"
                            placeholder="Ej., tipo y concentraci贸n de qu铆mico"
                            i18n-label="@@productLabelStockProcessingOrderDetail.treatment.chemicalUsed.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.treatment.chemicalUsed.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('treatmentChemicalUsed').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('treatmentChemicalUsed').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.treatment.chemicalUsed.error">
                                    El qu铆mico utilizado es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>
            </div>
        </ng-container>

        <!-- CAMPOS ESPECFICOS PARA CORTE (solo cuando el facility de entrada es de corte) -->
        <ng-container *ngIf="shouldShowCuttingSection()">
            <div class="af-row mt-3">
                <div class="af-c12">
                    <h4 i18n="@@productLabelStockProcessingOrderDetail.section.cutting.title">CORTE</h4>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c6">
                    <textinput
                            [form]="$any(tsoGroup.get('cuttingType'))"
                            label="Tipo de Corte"
                            placeholder="Ej., pelado, descabezado"
                            i18n-label="@@productLabelStockProcessingOrderDetail.cutting.type.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.cutting.type.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('cuttingType').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('cuttingType').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.cutting.type.error">
                                    El tipo de corte es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Ingreso"
                            i18n-label="@@productLabelStockProcessingOrderDetail.cutting.entryDate.label"
                            [form]="tsoGroup.get('cuttingEntryDate')"
                            [invalid]="submitted && tsoGroup.get('cuttingEntryDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('cuttingEntryDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.cutting.entryDate.error">
                                    La fecha de ingreso es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>

                <div class="af-c3">
                    <app-datepicker
                            label="Fecha de Salida"
                            i18n-label="@@productLabelStockProcessingOrderDetail.cutting.exitDate.label"
                            [form]="tsoGroup.get('cuttingExitDate')"
                            [invalid]="submitted && tsoGroup.get('cuttingExitDate').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('cuttingExitDate').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.cutting.exitDate.error">
                                    La fecha de salida es requerida
                                </div>
                            </div>
                        </ng-container>
                    </app-datepicker>
                </div>
            </div>

            <div class="af-row">
                <div class="af-c12">
                    <textinput
                            [form]="$any(tsoGroup.get('cuttingTemperatureControl'))"
                            label="Control de Temperatura"
                            placeholder="Ej., rango de temperaturas durante el corte"
                            i18n-label="@@productLabelStockProcessingOrderDetail.cutting.temperatureControl.label"
                            i18n-placeholder="@@productLabelStockProcessingOrderDetail.cutting.temperatureControl.placeholder"
                            [isInvalid]="submitted && tsoGroup.get('cuttingTemperatureControl').invalid">
                        <ng-container *ngIf="submitted">
                            <div *ngIf="tsoGroup.get('cuttingTemperatureControl').errors as errors" class="sc-invalid-feedback">
                                <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.cutting.temperatureControl.error">
                                    El control de temperatura es requerido
                                </div>
                            </div>
                        </ng-container>
                    </textinput>
                </div>
            </div>
        </ng-container>
        
        <!-- CAMPOS ESPECFICOS PARA LABORATORIO SEGN PRODUCTO -->
        <ng-container *ngIf="shouldShowLaboratoryFields(tsoGroup)">
            <app-processing-output-lab-shrimp
                [tsoGroup]="$any(tsoGroup)"
                [submitted]="submitted"
                [tsoIndex]="tsoGroupIndex">
            </app-processing-output-lab-shrimp>
        </ng-container>

        <!-- DISPLAY THE PROCESSING EVIDENCE FIELDS -->
        <ng-container *ngIf="selectedProcAction.requiredEvidenceFields">
            <app-stock-processing-order-fields
                    *ngFor="let fieldInfo of selectedProcAction.requiredEvidenceFields"
                    side="right"
                    [isQuote]="actionType === 'SHIPMENT'"
                    [fieldInfo]="fieldInfo"
                    [formGroup]="$any(tsoGroup.get('requiredProcEvidenceFieldGroup'))"
                    [submitted]="submitted">
            </app-stock-processing-order-fields>
        </ng-container>

        <!-- IF THE PROCESSING ACTION HAS SET 'repackedOutputs', DISPLAY LIST OF OUTPUT STOCK ORDERS -->
        <ng-container *ngIf="getTSOGroupRepackedOutputsArray(tsoGroup) as repackedOutputsArray">
            <ng-container *ngIf="repackedOutputsArray.length > 0">
                <div class="af-row mt-4">
                    <div class="af-c9">
                        <label i18n="@@productLabelStockProcessingOrderDetail.outputStockOrders.outputs.label">Outputs</label>
                    </div>

                    <div class="af-c3 text-right">
                        <button class="btn btn-solid round mr-2"
                                (click)="prefillRepackedOutputSOQuantities(tsoGroup)"
                                i18n="@@productLabelStockProcessingOrderDetail.outputStockOrders.prefill">
                            <span>Prefill</span>
                        </button>
                        <button class="btn btn-solid round"
                                (click)="addRepackedOutputStockOrder(tsoGroup)"
                                i18n="@@productLabelStockProcessingOrderDetail.outputStockOrders.add">
                            <span>+</span>
                        </button>
                    </div>
                </div>

                <div *ngFor="let repackedGroup of repackedOutputsArray.controls; index as repackedGroupIndex" class="af-row">
                    <div class="af-c12">
                        <div class="row">

                            <div class="col-3">
                                <textinput
                                        [form]="$any(repackedGroup.get('sacNumber'))"
                                        type="number"
                                        min="0"
                                        step="1"
                                        i18n-label="@@productLabelStockProcessingOrderDetail.textinput.sacNumber"
                                        label="Sac number"
                                        [isInvalid]="submitted && repackedGroup.get('sacNumber').invalid">
                                    <ng-container *ngIf="submitted">
                                        <div *ngIf="repackedGroup.get('sacNumber').errors as errors" class="sc-invalid-feedback">
                                            <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.textinput.sacNumber.required.error">
                                                Sac number is required
                                            </div>
                                        </div>
                                    </ng-container>
                                </textinput>
                            </div>

                            <div class="col-8">
                                <textinput
                                        [form]="$any(repackedGroup.get('totalQuantity'))"
                                        [label]="getRepackedSacQuantityLabel(tsoGroup)"
                                        [isInvalid]="submitted && repackedGroup.get('totalQuantity').invalid">
                                    <ng-container *ngIf="submitted">
                                        <div *ngIf="repackedGroup.get('totalQuantity').errors as errors" class="sc-invalid-feedback">
                                            <div *ngIf="errors.required" i18n="@@productLabelStockProcessingOrderDetail.textinput.quantity.required.error">
                                                Quantity is required
                                            </div>
                                            <div *ngIf="errors.max" i18n="@@productLabelStockProcessingOrderDetail.textinput.quantity.max.error">
                                                Input exceeds the max value
                                            </div>
                                        </div>
                                    </ng-container>
                                </textinput>
                            </div>

                            <div class="col-1">
                                <div class="delete-output-icon" (click)="removeRepackedOutputStockOrder(tsoGroup, repackedGroupIndex)">
                                    <fa-icon class="del-icon" [icon]="faTrashAlt"></fa-icon>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>

        <div *ngIf="!rightSideEnabled" class="disabled-section-overlay"></div>
        </div>
    </ng-container>

    <div *ngIf="showAddNewOutputButton" class="d-flex justify-content-end outputs-bottom-spacing">
        <button class="btn" type="button" (click)="addNewOutput()">
            <span i18n="@@productLabelStockProcessingOrderDetail.section.output.button.addAdditionalOutput">Add additional output</span>
        </button>
    </div>
</ng-container>
